<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>utils/fitHandler.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css" />
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css" />
    <script src="scripts/nav.js" defer></script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <input type="checkbox" id="nav-trigger" class="nav-trigger" />
    <label for="nav-trigger" class="navicon-button x">
      <div class="navicon"></div>
    </label>

    <label for="nav-trigger" class="overlay"></label>

    <nav>
      <h2><a href="index.html">Home</a></h2>
      <h3>Global</h3>
      <ul>
        <li>
          <a href="global.html#FormatMessageWrapper">FormatMessageWrapper</a>
        </li>
        <li>
          <a href="global.html#InteractionAssemble">InteractionAssemble</a>
        </li>
        <li><a href="global.html#TranslateLocale">TranslateLocale</a></li>
        <li><a href="global.html#actionCore">actionCore</a></li>
        <li><a href="global.html#animalType">animalType</a></li>
        <li><a href="global.html#apiRequest">apiRequest</a></li>
        <li><a href="global.html#apiSuccessCode">apiSuccessCode</a></li>
        <li><a href="global.html#appInitDefault">appInitDefault</a></li>
        <li>
          <a href="global.html#authenticationFailCode"
            >authenticationFailCode</a
          >
        </li>
        <li>
          <a href="global.html#buildRandomHexColor">buildRandomHexColor</a>
        </li>
        <li><a href="global.html#cardConfig">cardConfig</a></li>
        <li><a href="global.html#confirmActionCore">confirmActionCore</a></li>
        <li><a href="global.html#copyToClipboard">copyToClipboard</a></li>
        <li><a href="global.html#destroyMessage">destroyMessage</a></li>
        <li><a href="global.html#emptyLogic">emptyLogic</a></li>
        <li><a href="global.html#emptyLogo">emptyLogo</a></li>
        <li><a href="global.html#extraBuildType">extraBuildType</a></li>
        <li><a href="global.html#filterUpdateModel">filterUpdateModel</a></li>
        <li><a href="global.html#flushLocalStorage">flushLocalStorage</a></li>
        <li>
          <a href="global.html#flushSessionStorage">flushSessionStorage</a>
        </li>
        <li><a href="global.html#formatMessage">formatMessage</a></li>
        <li>
          <a href="global.html#getAuthorityFromRouter"
            >getAuthorityFromRouter</a
          >
        </li>
        <li><a href="global.html#getCorsDomain">getCorsDomain</a></li>
        <li>
          <a href="global.html#getDerivedStateFromPropertiesForUrlParameters"
            >getDerivedStateFromPropertiesForUrlParameters</a
          >
        </li>
        <li>
          <a
            href="global.html#getDerivedStateFromPropertiesForUrlParametersCore"
            >getDerivedStateFromPropertiesForUrlParametersCore</a
          >
        </li>
        <li>
          <a href="global.html#getFromLocalStorage">getFromLocalStorage</a>
        </li>
        <li>
          <a href="global.html#getFromSessionStorage">getFromSessionStorage</a>
        </li>
        <li><a href="global.html#getQueue">getQueue</a></li>
        <li><a href="global.html#getRouteAuthority">getRouteAuthority</a></li>
        <li><a href="global.html#logLevel">logLevel</a></li>
        <li>
          <a href="global.html#mobileTypeCollection">mobileTypeCollection</a>
        </li>
        <li><a href="global.html#modulePackageName">modulePackageName</a></li>
        <li><a href="global.html#notify">notify</a></li>
        <li><a href="global.html#numeralFormat">numeralFormat</a></li>
        <li><a href="global.html#remoteAction">remoteAction</a></li>
        <li><a href="global.html#removeLocalStorage">removeLocalStorage</a></li>
        <li>
          <a href="global.html#removeSessionStorage">removeSessionStorage</a>
        </li>
        <li>
          <a href="global.html#renderFurtherColorWhenNoCallProcess"
            >renderFurtherColorWhenNoCallProcess</a
          >
        </li>
        <li>
          <a href="global.html#renderFurtherPrefixWhenNoCallProcess"
            >renderFurtherPrefixWhenNoCallProcess</a
          >
        </li>
        <li><a href="global.html#saveToLocalStorage">saveToLocalStorage</a></li>
        <li>
          <a href="global.html#saveToSessionStorage">saveToSessionStorage</a>
        </li>
        <li>
          <a href="global.html#setEasySoftUtilityHandler"
            >setEasySoftUtilityHandler</a
          >
        </li>
        <li>
          <a href="global.html#setLocalStorageHandler"
            >setLocalStorageHandler</a
          >
        </li>
        <li>
          <a href="global.html#setMessageDisplayMonitor"
            >setMessageDisplayMonitor</a
          >
        </li>
        <li>
          <a href="global.html#setNavigationHandler">setNavigationHandler</a>
        </li>
        <li>
          <a href="global.html#setNotificationDisplayMonitor"
            >setNotificationDisplayMonitor</a
          >
        </li>
        <li><a href="global.html#setRequestHandler">setRequestHandler</a></li>
        <li>
          <a href="global.html#setSessionStorageHandler"
            >setSessionStorageHandler</a
          >
        </li>
        <li><a href="global.html#shallowUpdateEqual">shallowUpdateEqual</a></li>
        <li><a href="global.html#showInfoMessage">showInfoMessage</a></li>
        <li><a href="global.html#showWarningMessage">showWarningMessage</a></li>
        <li>
          <a href="global.html#unlimitedWithNumberFlag"
            >unlimitedWithNumberFlag</a
          >
        </li>
        <li>
          <a href="global.html#unlimitedWithStringFlag"
            >unlimitedWithStringFlag</a
          >
        </li>
        <li><a href="global.html#whetherList">whetherList</a></li>
      </ul>
    </nav>

    <div id="main">
      <h1 class="page-title">utils/fitHandler.js</h1>

      <section>
        <article>
          <pre class="prettyprint source linenums"><code>import {
  buildPromptModuleInfo,
  checkStringIsNullOrWhiteSpace,
  checkWhetherDevelopmentEnvironment,
  getApplicationMergeConfig,
  isArray,
  isBrowser,
  isObject,
  logError,
  logExecute,
  logTrace,
  mergeArrowText,
  mergeTextMessage,
  redirectTo,
  setApplicationExternalConfigList,
  setApplicationInitialConfig,
  setAuthenticationFailCode,
  setAuthenticationFailHandler,
  setAuthorizationFailHandler,
  setLoggerDisplaySwitch,
  setRuntimeDataStorage,
  setSuccessCode,
  setUrlGlobalPrefix,
  toNumber,
} from 'easy-soft-utility';

import { appInitDefault } from './constants';
import { modulePackageName } from './definition';
import { setLocalStorageHandler } from './localStorageAssist';
import { setMessageDisplayMonitor } from './messageAssist';
import { setNavigationHandler } from './navigationAssist';
import { setNotificationDisplayMonitor } from './notificationAssist';
import { setRequestHandler } from './requestAssist';
import { setSessionStorageHandler } from './sessionStorageAssist';
import {
  getApiVersion,
  getAuthenticationFailRedirectPath,
  getAuthorizationFailRedirectPath,
} from './settingAssist';

/**
 * Module Name.
 * @private
 */
const moduleName = 'fitHandler';

function buildPromptModuleInfoText(text, ...messages) {
  return buildPromptModuleInfo(
    modulePackageName,
    mergeTextMessage(text, mergeArrowText(...messages)),
    moduleName,
  );
}

function getShowLogInConsole() {
  const { showLogInConsole } = {
    showLogInConsole: false,
    ...getApplicationMergeConfig(),
  };

  return showLogInConsole || false;
}

function getSuccessCode() {
  const { successCode } = {
    successCode: appInitDefault.successCode,
    ...getApplicationMergeConfig(),
  };

  return toNumber(successCode || appInitDefault.successCode);
}

function getAuthenticationFailCode() {
  const { authenticationFailCode } = {
    authenticationFailCode: appInitDefault.authenticationFailCode,
    ...getApplicationMergeConfig(),
  };

  return toNumber(
    authenticationFailCode || appInitDefault.authenticationFailCode,
  );
}

function getExternalConfigs() {
  const list = [];

  if (isBrowser()) {
    if (isObject(window.appInitCustomLocalCore)) {
      list.push(window.appInitCustomLocalCore);
    }

    if (isObject(window.appInitCustomLocalSpecial)) {
      list.push(window.appInitCustomLocalSpecial);
    }

    if (isObject(window.appInitCustomRemote)) {
      list.push(window.appInitCustomRemote);
    }

    const applicationListData = [
      ...(isArray(appInitDefault.applicationListData)
        ? appInitDefault.applicationListData
        : []),
      ...((window.appInitCustomLocalCore || null) == null
        ? []
        : isArray(window.appInitCustomLocalCore.applicationListData)
          ? window.appInitCustomLocalCore.applicationListData
          : []),
      ...((window.appInitCustomLocalSpecial || null) == null
        ? []
        : isArray(window.appInitCustomLocalSpecial.applicationListData)
          ? window.appInitCustomLocalSpecial.applicationListData
          : []),
      ...((window.appInitCustomRemote || null) == null
        ? []
        : isArray(window.appInitCustomRemote.applicationListData)
          ? window.appInitCustomRemote.applicationListData
          : []),
    ];

    list.push({ applicationListData });
  }

  return list;
}

function handleAuthenticationFail() {
  logExecute({}, buildPromptModuleInfoText('handleAuthenticationFail'));

  const authenticationFailRedirectPath = getAuthenticationFailRedirectPath();

  if (checkStringIsNullOrWhiteSpace(authenticationFailRedirectPath)) {
    logError(
      'handleAuthenticationFail',
      'authenticationFailRedirectPath has not set yet, please set it in applicationConfig with key "authenticationFailRedirectPath"',
    );

    return;
  }

  setTimeout(() => {
    logTrace(
      buildPromptModuleInfoText(
        'handleAuthorizationFail',
        'redirectTo',
        `"${authenticationFailRedirectPath}" [get by getAuthenticationFailRedirectPath()]`,
      ),
    );
    redirectTo(authenticationFailRedirectPath);
  }, 100);
}

function handleAuthorizationFail() {
  logExecute({}, buildPromptModuleInfoText('handleAuthorizationFail'));

  const authorizationFailRedirectPath = getAuthorizationFailRedirectPath();

  if (checkStringIsNullOrWhiteSpace(authorizationFailRedirectPath)) {
    logError(
      'handleAuthorizationFail',
      'authorizationFailRedirectPath has not set yet, please set it in applicationConfig with key "authorizationFailRedirectPath"',
    );

    return;
  }

  setTimeout(() => {
    logTrace(
      buildPromptModuleInfoText(
        'handleAuthorizationFail',
        'redirectTo',
        `"${authorizationFailRedirectPath}" [get by getAuthorizationFailRedirectPath()]`,
      ),
    );

    redirectTo(authorizationFailRedirectPath);
  }, 100);
}

/**
 * 设置 easy-soft-utility 处理器
 */
export function setEasySoftUtilityHandler() {
  setLocalStorageHandler();

  setSessionStorageHandler();

  setNavigationHandler();

  setRuntimeDataStorage(window);

  setApplicationInitialConfig({
    ...appInitDefault,
    showLogInConsole: checkWhetherDevelopmentEnvironment(),
  });

  const externalConfigList = getExternalConfigs();

  setApplicationExternalConfigList(externalConfigList);

  setLoggerDisplaySwitch(getShowLogInConsole());

  setMessageDisplayMonitor();

  setNotificationDisplayMonitor();

  setSuccessCode(getSuccessCode());

  setAuthenticationFailCode(getAuthenticationFailCode());
  setAuthenticationFailHandler(handleAuthenticationFail);
  setAuthorizationFailHandler(handleAuthorizationFail);

  setUrlGlobalPrefix(getApiVersion());

  setRequestHandler();
}
</code></pre>
        </article>
      </section>
    </div>

    <br class="clear" />

    <footer>
      Documentation generated by
      <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.3</a> on Mon Jun 03
      2024 17:31:00 GMT+0800 (中国标准时间) using the
      <a href="https://github.com/clenemt/docdash">docdash</a> theme.
    </footer>

    <script>
      prettyPrint();
    </script>
    <script src="scripts/polyfill.js"></script>
    <script src="scripts/linenumber.js"></script>
  </body>
</html>
